<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Two YouTube Players with Transition</title>
</head>
<body>
    <!-- Visible YouTube Player -->
    <div id="player1"></div>

    <!-- Hidden YouTube Player -->
    <div id="player2" style="display: none;"></div>

    <script>
        // Load the YouTube IFrame API asynchronously
        var tag = document.createElement('script');
        tag.src = 'https://www.youtube.com/iframe_api';
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        var player1, player2;
        var playlist = [
            "1uQpw8GKjAM", //P8 M BG E3D2
            "F-4Xo9AV9g0", //P9 M BG E2D2
            "h5AngTovhkU", //P10 M BG E2D2
            "CmGvkG9xHgs", //P11 M BG
            "uQ1b04gSK2w", //P12 M BG E1D2
            "73pu1HRQEyE", //P13 M BG E4D2
        ]; // Array of video IDs. Add more video IDs as needed.
        var currentVideoIndex = 0;

        // Called when the YouTube IFrame API is ready
        function onYouTubeIframeAPIReady() {
            // Create the first player
            player1 = new YT.Player('player1', {
                height: '360',
                width: '640',
                videoId: playlist[currentVideoIndex++],
                playerVars: {
                    autoplay: 0,
                    controls: 1,
                    disablekb: 1,
                },
                events: {
                    'onStateChange': onPlayer1StateChange
                }
            });

            // Create the second player
            player2 = new YT.Player('player2', {
                height: '360',
                width: '640',
                videoId: playlist[currentVideoIndex++],
                playerVars: {
                    autoplay: 0,
                    controls: 1,
                    disablekb: 1,
                },
                events: {
                    'onStateChange': onPlayer2StateChange
                }
            });
        }

        // Called when the state of the first player changes
        function onPlayer1StateChange(event) {
            if (event.data === YT.PlayerState.ENDED) {
                if (currentVideoIndex <= playlist.length) {
                    //// Start playing the next video
                    //player2.playVideo();

                    // Hide player1
                    document.getElementById('player1').style.display = 'none';

                    // Show player2
                    document.getElementById('player2').style.display = 'block';

                    // Update the video ID for player1
                    player1.cueVideoById(playlist[currentVideoIndex++]);
                }
            }
        }

        // Called when the state of the second player changes
        function onPlayer2StateChange(event) {
            if (event.data === YT.PlayerState.ENDED) {
                if (currentVideoIndex <= playlist.length) {
                    //// Start playing the next video
                    //player1.playVideo();

                    // Hide player2
                    document.getElementById('player2').style.display = 'none';

                    // Show player1
                    document.getElementById('player1').style.display = 'block';

                    // Update the video ID for player2
                    player2.cueVideoById(playlist[currentVideoIndex++]);
                }
            }
        }

        var switched = 0;
        var playerIdx = 0
        var transitionTime = 1;
        setInterval(()=>{
            // faster switching of videos
            var players = [player1, player2];
            var player = players[playerIdx % players.length];
            if (!player) return;
            var duration = player.getDuration();
            var currentTime = player.getCurrentTime();
            var timeToEnd = duration - currentTime;
            // Check if the current video is close to ending and there's a next video
            if (timeToEnd <= transitionTime && switched < playlist.length-1) {
                switched++;
                playerIdx++;
                player = players[playerIdx % players.length];
                player.playVideo();
            }
        }, 500);

    </script>
</body>
</html>
