<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Two YouTube Players with Transition</title>
    <style>
        .hidden {
            display: none !important;
        }
        /* Style to disable pointer events on the player */
        .noinput {
            pointer-events: none;
        }

        /* Video Player Starter */
        .video-wrapper {
            width: 640px;
            height: 360px;
            position: relative;
            display: block;
            background: #007bff;
            color: #fff;
            border: 1px solid #007bff;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            overflow: hidden;
        }
        /* Add hover effect */
        .video-wrapper:hover {
            background: #006fff;
        }
        .video-playing {
            background: #000;
            pointer-events: none;
        }
        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .play-button::after {
            content: '';
            width: 0;
            height: 0;
            margin-left: 10px;
            border-top: 20px solid transparent;
            border-bottom: 20px solid transparent;
            border-left: 30px solid #333;
        }
    </style>
</head>
<body>
    <div id="videoWrapper" class="video-wrapper">
        <div id="playButton" class="play-button noinput"></div>
        <!-- Hidden YouTube Player1 -->
        <div id="player1" class="noinput hidden"></div>
        <!-- Hidden YouTube Player2 -->
        <div id="player2" class="noinput hidden"></div>
    </div>
    <script>
        var videoWrapper = document.getElementById('videoWrapper');
        var playButton = document.getElementById('playButton');

        videoWrapper.addEventListener('click', function() {
            videoWrapper.classList.add('video-playing');
            playButton.classList.add('hidden');
            player1.playVideo();
        });

        // Load the YouTube IFrame API asynchronously
        var tag = document.createElement('script');
        tag.src = 'https://www.youtube.com/iframe_api';
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        var player1, player2;
        var playlist = [
            "1uQpw8GKjAM", //P8 M BG E3D2
            "F-4Xo9AV9g0", //P9 M BG E2D2
            "h5AngTovhkU", //P10 M BG E2D2
            "CmGvkG9xHgs", //P11 M BG
            "uQ1b04gSK2w", //P12 M BG E1D2
            "73pu1HRQEyE", //P13 M BG E4D2
        ]; // Array of video IDs. Add more video IDs as needed.
        var currentVideoIndex = 0;
        var switched = 0;
        var playerIdx = 0;
        var transitionTime = 2;

        // Called when the YouTube IFrame API is ready
        function onYouTubeIframeAPIReady() {
            // Create the first player
            player1 = new YT.Player('player1', {
                height: '360',
                width: '640',
                videoId: playlist[currentVideoIndex++],
                playerVars: {
                    autoplay: 0,
                    controls: 0,
                    disablekb: 1,
                },
                events: {
                    'onStateChange': onPlayer1StateChange
                }
            });

            // Create the second player
            player2 = new YT.Player('player2', {
                height: '360',
                width: '640',
                videoId: playlist[currentVideoIndex++],
                playerVars: {
                    autoplay: 0,
                    controls: 0,
                    disablekb: 1,
                },
                events: {
                    'onStateChange': onPlayer2StateChange
                }
            });
        }

        // Called when the state of the player1 changes
        function onPlayer1StateChange(event) {
            if (event.data == YT.PlayerState.PLAYING) {
                document.getElementById('player1').classList.remove('hidden'); //show player1
                document.getElementById('player2').classList.add('hidden');    //hide player2
            }
            if (event.data === YT.PlayerState.ENDED) {
                document.getElementById('player1').classList.add('hidden');    //hide player1
                if (currentVideoIndex <= playlist.length) {
                    // Cue next video for player1 and update currentVideoIndex
                    player1.cueVideoById(playlist[currentVideoIndex++]);
                } else {
                    // Reset all player states so we can play again
                    resetPlayers();
                }
            }
        }

        // Called when the state of the player2 changes
        function onPlayer2StateChange(event) {
            if (event.data == YT.PlayerState.PLAYING) {
                document.getElementById('player2').classList.remove('hidden'); //show player2
                document.getElementById('player1').classList.add('hidden');    //hide player1
            }
            if (event.data === YT.PlayerState.ENDED) {
                document.getElementById('player2').classList.add('hidden');    //hide player2
                if (currentVideoIndex <= playlist.length) {
                    // Cue next video for player2 and update currentVideoIndex
                    player2.cueVideoById(playlist[currentVideoIndex++]);
                } else {
                    // Reset all player states so we can play again
                    resetPlayers();
                }
            }
        }

        setInterval(()=>{
            // faster switching of videos
            var players = [player1, player2];
            var player = players[playerIdx % players.length];
            if (player == null || player.getDuration == null) return;
            var duration = player.getDuration();
            var currentTime = player.getCurrentTime();
            var timeToEnd = duration - currentTime;
            // Check if the current video is close to ending and there's a next video
            if (timeToEnd <= transitionTime && switched < playlist.length-1) {
                switched++;
                playerIdx++;
                player = players[playerIdx % players.length];
                player.playVideo();
            }
        }, transitionTime * 100 / 2);

        function resetPlayers() {
            document.getElementById('player1').classList.add('hidden');
            document.getElementById('player2').classList.add('hidden');

            switched = 0;
            playerIdx = 0;
            currentVideoIndex = 0;
            player1.cueVideoById(playlist[currentVideoIndex++]);
            player2.cueVideoById(playlist[currentVideoIndex++]);
            videoWrapper.classList.remove('video-playing');
            playButton.classList.remove('hidden');
        }

    </script>
</body>
</html>